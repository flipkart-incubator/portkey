<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:mvc="http://www.springframework.org/schema/mvc"
    xmlns:util="http://www.springframework.org/schema/util" xmlns:mockito="http://www.mockito.org/spring/mockito"
    xsi:schemaLocation="
        http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util-3.0.xsd
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

	<bean
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location" value="classpath:project.properties" />
	</bean>

	<bean id="rdbmsDataStore" class="com.flipkart.portkey.rdbms.datastore.RdbmsDataStore">
		<property name="shardIdToPersistenceManagerMap" ref="shardIdToPersistenceManagerMap" />
		<property name="metaDataCache" ref="rdbmsMetaDataCache" />
	</bean>

	<util:map id="shardIdToPersistenceManagerMap" key-type="String"
		value-type="com.flipkart.portkey.common.persistence.PersistenceManager">
		<entry key="01" value-ref="shard1" />
	</util:map>

	<bean id="rdbmsMetaDataCache" class="com.flipkart.portkey.rdbms.metadata.RdbmsMetaDataCache"
		factory-method="getInstance" />

	<bean id="shard1"
		class="com.flipkart.portkey.rdbms.persistence.RdbmsPersistenceManager">
		<constructor-arg ref="shard1Config" />
	</bean>
	<bean id="shard1Config"
		class="com.flipkart.portkey.rdbms.persistence.config.RdbmsPersistenceManagerConfig">
		<property name="master" ref="shard1Master" />
		<property name="slaves" ref="shard1Slaves" />
	</bean>

	<bean id="shard1Master" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="driverClass">
			<value>com.mysql.jdbc.Driver</value>
		</property>
		<property name="jdbcUrl">
			<value>${RDBMS_SHARD1_MASTER_JDBC_URL}</value>
		</property>
		<property name="properties">
			<props>
				<prop key="c3p0.acquire_increment">${C3P0_ACQUIRE_INCREMENT}</prop>
				<prop key="c3p0.idle_test_period">${C3P0_IDLE_TEST_PERIOD}</prop>
				<prop key="c3p0.max_size">${C3P0_MAX_SIZE}</prop>
				<prop key="c3p0.max_statements">${C3P0_MAX_STATEMENTS}</prop>
				<prop key="c3p0.min_size">${C3P0_MIN_SIZE}</prop>
				<prop key="c3p0.testConnectionOnCheckin">true</prop>
				<prop key="c3p0.preferredTestQuery">SELECT 1</prop>
				<prop key="user">${RDBMS_SHARD1_MASTER1_USER}</prop>
				<prop key="password">${RDBMS_SHARD1_MASTER1_PASSWORD}</prop>
			</props>
		</property>
		<property name="idleConnectionTestPeriod" value="900" />
		<property name="preferredTestQuery" value="select 1 from DUAL" />
	</bean>

	<bean id="shard1Slave1" class="com.mchange.v2.c3p0.ComboPooledDataSource"
		destroy-method="close">
		<property name="driverClass">
			<value>com.mysql.jdbc.Driver</value>
		</property>
		<property name="jdbcUrl">
			<value>${RDBMS_SHARD1_SLAVE1_JDBC_URL}</value>
		</property>
		<property name="properties">
			<props>
				<prop key="c3p0.acquire_increment">${C3P0_ACQUIRE_INCREMENT}</prop>
				<prop key="c3p0.idle_test_period">${C3P0_IDLE_TEST_PERIOD}</prop>
				<prop key="c3p0.max_size">${C3P0_MAX_SIZE}</prop>
				<prop key="c3p0.max_statements">${C3P0_MAX_STATEMENTS}</prop>
				<prop key="c3p0.min_size">${C3P0_MIN_SIZE}</prop>
				<prop key="c3p0.testConnectionOnCheckin">true</prop>
				<prop key="c3p0.preferredTestQuery">SELECT 1</prop>
				<prop key="user">${RDBMS_SHARD1_SLAVE1_USER}</prop>
				<prop key="password">${RDBMS_SHARD1_SLAVE1_PASSWORD}</prop>
			</props>
		</property>
		<property name="idleConnectionTestPeriod" value="900" />
		<property name="preferredTestQuery" value="select 1 from DUAL" />
	</bean>
</beans>